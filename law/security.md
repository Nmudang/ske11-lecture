# Threats and Vulnerabilities

หัวข้อจาก http://www.professormesser.com/security-plus/sy0-401/sy0-401-course-index/

## Malware

Malware = โปรแกรมที่ไม่พึงประสงค์

1. **Virus** เป็นโปรแกรมที่ copy ตัวเองไปได้เรื่อยๆ อาจใช้ช่องโหว่ทำให้ทำงานเองได้โดยผู้ใช้ไม่ต้องทำะไรเลย
   - **Boot sector virus** ฝังตังเองไว้ในส่วน Boot sector ทำให้ถอดได้ยาก ปัจจุบันไม่มีแล้ว
   - **Program virus** ก็คือไวรัสทั่วๆ ไป เช่น ไวรัส Folder ปลอม
   - **Script virus** ไวรัสที่เขียนในภาษาสคริปต์ เช่น JavaScript หรือ .vbs ตัวอย่างเช่น Hacked by Godzilla (vbs)
   - **Macro virus** คือไวรัสที่ฝังมากับเอกสาร Microsoft Office เพราะเอกสารพวกนี้สามารถเขียนโปรแกรมพ่วงมาด้วยได้
   - **Worm** คือไวรัสที่ติดผ่านเครือข่ายได้ ถ้าเครื่องนึงติดเครื่องที่ต่อ LAN กันอยู่จะติดไปเองโดยอาศัยช่องโหว่ของโปรแกรม/OS ต่างกับไวรัสที่ต้องมีพาหะไป เช่น Flash drive สามารถป้องกัน worm ได้โดยติดตั้ง Antivirus และ Firewall ตัวอย่าง worm เช่น [Blaster](https://en.wikipedia.org/wiki/Blaster_(computer_worm)) (ที่มาของชื่อ [หยง บลัสเตอร์](http://th.uncyclopedia.info/wiki/%E0%B8%AB%E0%B8%A2%E0%B8%87%E0%B8%9A%E0%B8%A5%E0%B8%B1%E0%B8%AA%E0%B9%80%E0%B8%95%E0%B8%AD%E0%B8%A3%E0%B9%8C#.E0.B8.97.E0.B8.B5.E0.B9.88.E0.B8.A1.E0.B8.B2.E0.B8.82.E0.B8.AD.E0.B8.87.E0.B8.84.E0.B8.B3.E0.B8.99.E0.B8.B5.E0.B9.89))
   - ทั้งนี้ Virus ใช้เรียกตามลักษณะการแพร่กระจาย ไม่ได้กล่าวถึงพฤติกรรมเมื่อติดไวรัสแล้ว
2. **Adware/Spyware** คือโปรแกรมกวนใจที่จะแสดงข้อความโฆษณา เช่น Baidu PC Faster, Hao123 และอาจมีการดักข้อมูลผู้ใช้งานส่งกลับไปหาผู้ผลิตด้วย
3. **Trojan** คือโปรแกรมที่ดูเหมือนเป็นโปรแกรมดี เพื่อให้ user download มาใช้งาน แต่ฝังการทำงานประสงค์ร้ายไว้ เช่น Antivirus ปลอม
4. **Rookit** คือโปรแกรมที่จะเข้าไปฝังตัวเป็นส่วนหนึ่งของ OS เพื่อให้ตรวจจับได้ยากมาก (ไม่เห็นใน task manager) ตัวอย่างเช่น [Rootkit ใน CD เพลงของ Sony BMG](https://en.wikipedia.org/wiki/Sony_BMG_copy_protection_rootkit_scandal) เพื่อป้องกันการ copy CD ทำให้ Sony ถูกฟ้องร้อง
5. **Logic bomb** คือโค้ดที่ตั้งเวลาไว้ให้เกิดผลกระทบทีหลัง เช่นเกม [Spintires](https://www.reddit.com/r/pcgaming/comments/48juu7/spintires_publisher_installed_a_time_bomb_in_the/) ผู้พัฒนาตั้งเวลาไว้ให้เกมเด้งเพื่อป้องกันกรณีที่ publisher ไม่จ่ายเงินก็จะไม่ส่งโค้ดใหม่ให้
6. **Botnet** คือ malware ที่ทำให้เจ้าของ botnet ควบคุมคอมเราได้ เช่น ส่งไวรัส หรือยิง DDoS
7. **Ransomware** คือ malware ที่จะล็อคไม่ให้ใช้คอม หรือเข้ารหัสไฟล์ของเราไว้ และจะยกเลิกการทำงานเมื่อเราจ่ายเงินซื้อโค้ดปลดล็อคจากผู้สร้าง เช่น [TeslaCrypt](https://en.wikipedia.org/wiki/TeslaCrypt)
8. **Polymorphic malware** คือ malware ที่เปลี่ยนแปลงตัวเองไปเรื่อยๆ เพื่อป้องกันไม่ให้ antivirus ที่อาศัยการจับ checksum หรือพฤติกรรม (heuristic) จับได้
9. **Armored virus** คือไวรัสที่มีการเข้ารหัสไว้เพื่อป้องกันไม่ให้นักวิจัยวิเคราะห์การทำงานได้ เช่น [Stuxnet](https://www.wired.com/2011/07/how-digital-detectives-deciphered-stuxnet/)

## Attack

การ hack ทำได้หลายรูปแบบ ดังนี้

1. **Man in the Middle** *(MITM)* เรียกง่ายๆ ว่าดักฟัง มีทั้งแบบที่ดักฟังเฉยๆ และสามารถแอบแก้ไข (เพิ่ม/ลบ) ข้อมูลได้ด้วย โดยทั่วไปอาศัยเทคนิคที่ทำให้เปลี่ยนเส้นทางการเชื่อมต่อให้มาหาผู้โจมตี แล้วจากผู้โจมตีไปหาคู่สนทนา ![MITM](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Man_in_the_middle_attack.svg/260px-Man_in_the_middle_attack.svg.png)
2. **Denial of Service** *(DoS)* ก็คือการทำให้ล่ม อาจจะใช้ช่องโหว่ หรือยิงถล่มกันโต้งๆ ก็ได้ ถ้ายิงมาจากหลายที่พร้อมกันจะเรียกว่า Distributed Denial of Service (DDoS)
3. **Replay attack** คือการเอาข้อมูลที่ได้มาจากการดักฟังไปฉายซ้ำ เช่นโดนดักรหัสผ่านไป ถึงรหัสผ่านที่ส่งจะเข้ารหัสไว้ทำให้ไม่รู้รหัสจริง แต่ถ้าส่งข้อมูลนี้ซ้ำก็จะทำให้ login ได้เหมือนกัน ปกติแล้วจะใช้เทคนิค nonce (number used only once) แก้ปัญหา โดยเติมตัวเลขอะไรก็ได้เข้าไปในข้อมูลที่ส่ง แล้วตรวจจับเมื่อมีการใช้ตัวเลขเดิมซ้ำ
4. **Spoofing** คือการปลอมตัว อาจจะปลอมต้นทาง (เช่น ส่งอีเมลปลอม) หรือปลายทาง (Man in the Middle Attack)
5. **Spam**
6. **Phishing** คือการปลอมตัวลักษณะหนึ่ง โดยทำเว็บปลอมขึ้นมาแล้วส่งอีเมลไปหลอกให้เป้าหมายเข้ามาที่เว็บแล้วหลอกเอารหัสผ่าน ทั้งเว็บและอีเมลจะใช้รูปแบบคล้ายๆ ของจริงเพื่อให้เป้าหมายตายใจ ![Phishing](http://www.kasikornbank.com/TH/ServicesChannel/SearchServiceChannel/Internet/NewKCyberBanking/PublishingImages/for%20Security%20Tips/sample20phishing20K-Cyber-th.jpg)
7. **Vising** คือการทำ Phishing ทางโทรศัพท์ เช่น โทรมาหลอกให้โอนเงิน
8. **Christmas Tree Attack** เป็นการส่ง TCP packet ที่อยู่ในทุกสถานะพร้อมกัน (ผิดจาก TCP standard) ไปเพื่อสังเกตการทำงานของอุปกรณ์เป้าหมาย และอาจใช้เดา OS/รุ่นของ router เป้าหมายได้
9. **Privilege Escalation** คือการใช้ช่องโหว่เพื่อให้มีสิทธิ์มากกว่าโปรแกรมปกติได้ เช่นการ [Jailbreak iPhone](http://geohot.com/e7writeup.html)
10. **Insider Threats** ภาษาไทยเรียก สาวไส้ให้กากิน
11. **Transitive Attack** คือการที่โดนเจาะแล้วไปเจาะเครื่องอื่นต่อได้ เช่นถ้า firewall อนุญาตให้เข้าเครื่อง C ได้เครื่องเดียว ถ้า C โดนเจาะ เครื่อง A, B ก็อาจจะถูกเจาะโดยอาศัย C เป็นทางผ่าน
12. **Password attack**
   - **Brute force attack** คือการเดารหัสไปเรื่อยๆ ตำราภาษาไทยใช้คำว่า การตะลุย ป้องกันได้โดยจำกัดจำนวนครั้งที่ใส่รหัสผิดได้
   - **Dictionary attack** คือการลองรหัสจาก dictionary
   - **Hybrid attack** คือการใช้วิธีข้างบนผสมกัน เช่น เปลี่ยนตัวอักษรตัว a เป็น 4
   - **Birthday attack** ใช้ [Birthday problem](https://en.wikipedia.org/wiki/Birthday_problem) เป็นประโยชน์โดยการหา hash collision หรือข้อความที่ hash แล้วจะได้ hash เดียวกันกับรหัสผ่าน (อาจจะเป็นคนละข้อความกับรหัสผ่าน) แก้ไขได้โดยเลือกใช้ hash function ที่ป้องกัน hash collision ได้ดี เช่น MD5, SHA1 **ไม่**ควรใช้
   - **Rainbow table** คือการคำนวณ brute force เก็บใส่ไฟล์ไว้ล่วงหน้า เวลารหัสหลุดออกมาก็เปิดตารางตอบได้เลย
13. **URL Hijacking** คือการจดชื่อเว็บไซต์ดักคนพิมพ์ผิด เช่น gogle.com หรือเปลี่ยนนามสกุล เช่น ku.in.th
14. **Watering hole attack** คือการ hack เจาะจงเป้าหมาย โดยสังเกตพฤติกรรมเป้าหมายแล้วพยายาม hack สิ่งที่เป้าหมายใช้งานด้วย (เช่น เว็บไซต์) เพื่อให้เป้าหมายไม่สังเกต

## Social engineering

Social engineering คือการใช้ช่องโหว่จากคนเข้ามาเจาะระบบ โดยไม่ได้เจาะจากระบบโดยตรง

1. **Shoulder Surfing** คือการแอบมองจอ ทั้งตอนใช้อยู่ หรือทิ้งคอมไว้ไม่ล็อคจอ
2. **Dumpster Diving** คือการคุ้ยขยะ อาจจะเจอเอกสารสำคัญที่ทิ้งโดยไม่ทำลายก่อน
3. **Tailgating** คือการเนียนผ่านการตรวจบัตร เช่นการถือของเต็มมือแล้วหลอกให้คนเปิดประตูให้ หรือปลอมเป็นช่างซ่อม
4. **Impersonation** คือการสวมรอยเป็นคนอื่น เช่นโทรมาแล้วอ้างว่าเป็นฝ่าย IT ขอรหัสผ่าน
5. **Hoaxes** คือการส่งข้อมูลหลอกลวง อาจจะเป็น forward mail หรือ Facebook
6. **Whaling** คือ hack ที่เจาะจงเป้าหมายเป็นบุคคลสำคัญ เช่น ผู้บริหาร

## Wireless attack

1. **Rogue access point** คือ access point ที่แอบพ่วงเข้ามาใน network ของเรา อาจจะ config ไว้ไม่ปลอดภัยทำให้บุคคลภายนอกเชื่อมต่อเข้ามาภายใน network ของเราได้
2. **Wireless evil twin** คือการทำ wifi ปลอมที่ทำให้เหมือน wifi ที่มีอยู่แล้ว เพื่อหลอกให้ผู้ใช้เชื่อมต่อเข้ามา วิธีแก้ไขควรจะตั้งรหัสผ่านเพื่อให้ทำปลอมได้ยาก และใช้โปรแกรม VPN เพื่อป้องกัน man in the middle attack
3. **Wireless Interference** คือการปล่อยคลื่นรบกวน (jam) ทำให้ไม่สามารถใช้ wifi ได้
4. **Wardriving** คือการใช้มือถือและขับรถวนเพื่อเก็บข้อมูล access point บวกกับพิกัด GPS ซึ่งอาจใช้เป็นข้อมูลในการหาเหยื่อได้ เช่น เจาะจง wifi ที่ไม่ล็อครหัส
5. **Bluejacking** คือการส่ง spam หาอุปกรณ์ bluetooth ที่เปิดให้มองเห็นได้
ุ6. **Bluesnarfing** คือการใช้ช่องโหว่ bluetooth เพื่อขโมยข้อมูล (ปัจจุบันไม่มีแล้ว)
7. **Wireless IV attack** เป็นการอาศัยช่องโหว่ทางวิทยาการรหัสลับเพื่อแกะข้อมูล
8. **Wireless Packet Analysis** คือการดักฟัง wireless ซึ่งถ้าไม่ได้ล็อครหัส wifi ไว้ก็จะเห็นข้อมูลที่ส่งทั้งหมด
9. **Wireless replay** คล้ายๆ กับ replay attack ก่อนหน้านี้ โดยจะส่ง packet wifi ซ้ำ ซึ่งเป็นเทคนิคหนึ่งที่ใช้ในการ crack รหัส wifi ที่เข้ารหัสแบบ WEP
10. **WPA Attack** ซึ่ง WPA นั้นยังมีช่องโหว่อยู่แต่ใช้เจาะระบบได้ยาก ส่วน WPA2 นั้นปัจจุบันยังไม่มีวิธีการเจาะระบบ
11. **WPS Attack** โดย router รุ่นใหม่ๆ จะมีระบบ WPS ที่ใช้เลข 8 หลักเข้าแทนรหัสไวไฟได้ แต่ด้วยกระบวนการตรวจสอบทำให้มีรหัสได้แค่ 11,000 แบบซึ่งสามารถ brute force เอาได้

### IV attack

จะจำไม่จำแล้วแต่ชอบละกัน

กระบวนการเข้ารหัส WEP นั้นจะใช้อัลกอริธึมเข้ารหัส RC4 โดยวิธีการทำงานมีดังนี้

1. ผู้ใช้งานกำหนดรหัสไวไฟเป็นเลขฐาน 16 จำนวน 10 ตัว ทำให้ได้ข้อมูลจำนวน 40 บิต (ต่อมามีการเพิ่มเป็นแบบ 26 ตัว 104 บิต)
2. เมื่อมีการส่งข้อมูลจะทำการสุ่มเลข IV ขึ้นมาขนาด 24 บิต และนำไปต่อท้ายรหัสไวไฟทำให้ได้ keystream ขนาด 64/128 บิต
3. ใช้ keystream ที่ได้เป็นพารามิเตอร์ให้กับ RC4 จะได้ข้อมูลแบบสุ่มขึ้นมาจำนวนหนึ่ง
4. นำข้อมูลสุ่มนั้นไป exclusive or กับข้อมูลที่ต้องการจะส่ง ได้เป็นข้อมูลเข้ารหัสซึ่งจะส่งไปพร้อมกับ IV ที่ไม่ได้เข้ารหัส
5. ผู้รับได้รับ IV และข้อมูลเข้ารหัส ผู้รับทราบรหัสไวไฟ จึงทำกระบวนการ 1-4 เช่นกัน เมื่อทำ exclusive or 2 ครั้งจะหักล้างกันทำให้ได้ข้อมูลต้นฉบับกลับมา

ปัญหาคือ IV จำนวน 24 บิตนั้นทำให้มีตัวเลขได้จำกัด (2^24 แบบ) เมื่อเทียบกับปริมาณข้อมูลไวไฟที่ส่งไปมาจำนวนมากแล้วอาจทำให้เกิดกรณีใช้ IV ซ้ำได้ และส่งผลให้สามารถแก้สมการหารหัสไวไฟได้

เพื่อให้ปริมาณข้อมูลไวไฟมีมากพอที่จะทำให้ถอดรหัสได้ อาจจะใช้ replay attack เข้ามาช่วยเพื่อบังคับให้อุปกรณ์ในเครือข่ายส่งแพ็คเกจออกมาเพิ่ม

กระบวนการนี้คือกระบวนการที่่ใช้ในโปรแกรมชุด aircrack-ng เพื่อถอดรหัสไวไฟ

## Application attack

1. **Cross site scripting** คือการแทรกข้อมูลที่เป็น HTML ลงไปในหน้าเว็บไซต์ อาจจะมีการเรียก tag `<script>` เข้ามาเกี่ยวข้องด้วย เช่นกรณีแฮคเว็บ exceed vote บางกลุ่ม
2. **SQL Injection** คือการแทรกคำสั่งไปกลาง SQL เช่น ถ้าสั่ง SQL ว่า `SELECT * FROM users WHERE username="$1"` แล้วผู้โจมตีกำหนดให้ `$1=" OR "1"="1` จะส่งผลให้ SQL รวมกลายเป็น `SELECT * FROM users WHERE username="" OR "1"="1"` ทำให้เลือกทุกแถวใน database ออกมา
3. **Directory traversal** คือการที่โปรแกรมให้ระบุไฟล์ แล้วผู้โจมตีระบุไฟล์ที่มี `../../../` เข้าไป ทำให้สามารถเลือกไฟล์จากนอก directory ได้
4. **Command injection** คล้ายๆ SQL injection แต่เป็นการเรียกคำสั่งใน terminal
5. **Buffer overflow** คือการส่งข้อมูลไปเกินที่พักข้อมูล เช่น ประกาศตัวแปรว่า `char message[20];` แต่ผู้โจมตีส่งข้อความยาวเกิน 20 ตัวอักษรเข้ามา ทำให้สามารถเขียน memory ข้างเคียงได้
6. **Integer overflow** คือการส่งจำนวนที่มีขนาดใหญ่มากเกินกว่าข้อมูลสูงสุดในชนิดตัวแปรที่รับค่าจะรับได้ ตัวอย่างเช่น [ในเกม Civilization](http://kotaku.com/why-gandhi-is-such-an-asshole-in-civilization-1653818245) คานธีมีค่าความรุนแรงต่ำสุดคือ 1 แต่เมื่อคานธีประกาศใช้ระบอบประชาธิปไตย ค่าความรุนแรงจะลดลง 2 ระดับ ตัวเลขจึงวนจาก 1 เป็น 255 คานธีจึงปล่อยนิวเคลียร์ไม่ยั้ง
7. **Zero day attack** คือการใช้ช่องโหว่ใหม่ที่เพิ่งเปิดเผยสดๆ ร้อนๆ มาโจมตี ผู้ดูแลระบบจึงควรหมั่นอัพเดตซอฟต์แวร์เป็นประจำ
8. **Session hijacking** โดยปกติแล้วเวลาเข้า login website เว็บจะให้ข้อมูลสุ่มมาใน cookie เรียกว่า session id แต่ถ้าข้อมูลนี้ถูกขโมยไป ผู้โจมตีสามารถแก้ไข cookie เพื่อกำหนด session ID ตัวเองให้เป็นของเหยื่อ จะทำให้เว็บไซต์เข้าใจว่า login เป็นคนอื่น วิธีแก้ไขควรไม่เปิดเผย session id เช่น ใช้ HTTPS, VPN
9. **Flash cookie** ใน Flash สามารถเก็บข้อมูลได้เรียกว่า Locally shared objects (LSO) ซึ่งอาจใช้ติดตามพฤติกรรมของผู้ใช้งานได้
10. **Malicious attachment** ก็คือไวรัสนั่นแหละ
11. **Malicious addon** คือ malware ประเภทที่ทำตัวเป็นส่วนขยายของโปรแกรมอื่น เช่น extension ของ browser
12. **Arbitary code execution** คือการใช้ช่องโหว่ในโปรแกรม (เช่น buffer overflow) เพื่อทำให้สามารถแทรกโค้ดใดๆ เข้าไปก็ได้ [ตัวอย่าง](https://www.youtube.com/watch?v=hB6eY73sLV0)
13. **Remote code execution** เหมือนข้อ 12 แต่ทำผ่าน network

## Mitigation techniques

วิธีป้องกันทำอย่างไร?

1. **เฝ้าระวัง log**
   1. Event log บันทึกเหตุการณ์ เช่น มีคน login
   2. Audit log จะบันทึกเหตุการณ์เฉพาะกรณีที่มีการแก้ไขข้อมูล
2. **ปรับแต่ง OS ให้ปลอดภัย** (Hardening)
   1. อัพเดตโปรแกรมสม่ำเสมอ
   2. ปิด service ที่ไม่ใช้งาน
   3. ใช้ 2 Factor Authentication
   4. กำหนดจำนวนครั้งที่ใส่รหัสผ่านผิดได้
   5. กำหนดนโยบายรหัสผ่าน เช่น ความซับซ้อน ระยะเวลาที่เปลี่ยนรหัสผ่าน
   6. ลบ account default ของระบบออก
3. ตั้งให้มีการลงทะเบียน MAC Address ป้องกันบุคคลภายนอกเข้าใช้งาน
4. ปิด port LAN บน switch ที่ไม่ใช้
